<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

    <record id="view_product_category_form" model="ir.ui.view">
        <field name="name">product.category.form.3p.inherit</field>
        <field name="model">product.category</field>
        <field name="inherit_id" ref="product.product_category_form_view"/>
        <field name="arch" type="xml">
            <field name="type" position="after">
                <field name="repord_3p_supplier"/>
            </field>
        </field>
    </record>

    <record id="view_partner_form" model="ir.ui.view">
        <field name="name">res.partner.form</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <field name="website" position="after">
                <field name="product_ids" widget="many2many_tags"/>
                <field name="listing_id"/>
                <field name="repord_3p_supplier" groups="base.group_sale_manager"/>
            </field>
        </field>
    </record>

    <record id="view_partner_listing_form" model="ir.ui.view">
        <field name="name">res.partner.listing.form</field>
        <field name="model">res.partner.listing</field>
        <field name="type">form</field>
        <field name="arch" type="xml">
            <form string="Listing">
                <sheet>
                    <div class="oe_title" style="width: 420px;">
                        <label class="oe_edit_only" for="name" string="Listing Name"/>
                        <h1><field name="name" placeholder="ICA Kvantum" class="oe_inline"/></h1>
                    </div>
                    <field name="product_ids" string="Products" widget="many2many_tags"/>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_partner_listing_tree" model="ir.ui.view">
        <field name="name">res.partner.listing.tree</field>
        <field name="model">res.partner.listing</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="product_ids"/>
            </tree>
        </field>
    </record>

    <record id="action_res_partner_listing" model="ir.actions.act_window">
        <field name="name">res.partner.listing.action</field>
        <field name="res_model">res.partner.listing</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_partner_listing_tree"/>
        <field name="context">{"search_default_current": 1}</field>
    </record>

    <menuitem id="menu_res_partner_listing" name="Partner Listing" parent="base.menu_product" sequence="30" action="action_res_partner_listing" groups="base.group_sale_salesman"/>

    <template id="mobile_order_view" name="Mobile Order View">
        <t t-call="website.layout">
            <div id="wrap">
                <div class="oe_structure">
                    <t t-call="crm_repord.search_stores"/>
                    <div class="container" style="width: 100%; padding: 0px;">
                        <span t-field="partner.image" t-field-options="{&quot;widget&quot;: &quot;image&quot;, &quot;style&quot;:&quot;margin: auto; margin-top: 40px; max-height: 70px;&quot;}"/>
                        <p class="text-center mt16 mb16" style="font-size: 2.3em; font-weight: 300; color: #6a6a6a;" t-field="partner.name"/>
                        <t t-set="product_categories" t-value="request.env['product.category'].search([('parent_id', '=', request.env.ref('product.product_category_1').id)], order='id')"/>
                        <!-- <h2 class="text-center mb32" t-esc="partner.name"/> -->
                        <!-- navigator -->
                        <div class="col-md-12 col-sm-12 col-xs-12">
                            <div class="col-md-12 col-sm-12 col-xs-12">
                                <ul class="nav nav-tabs nav-justified nav-brand mt16 mb16 text-center" style="padding: 0px 15px 0px 15px; margin: auto;">
                                    <t t-foreach="product_categories" t-as="brand_categs">
                                        <li t-att-class="'active' if brand_categs == product_categories[0] else ''">
                                            <a data-toggle="tab" style="border-width: 0px;" t-att-href="'&#35;categs_%s' %brand_categs.id"><span style="vertical-align: middle;" t-field="brand_categs.name"/></a>
                                        </li>
                                    </t>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-12 col-sm-12 col-xs-12" style="width: 100%; padding: 0px 15px;">
                            <ul class="nav nav-tabs nav-justified nav-categ">
                                <li class="active">
                                    <a data-toggle="tab" href="#butiksorder" style="border-bottom-style: none;">Order</a>
                                </li>
                                <li>
                                    <a data-toggle="tab" href="#kedjans_sortiment" style="border: 1px solid #CED2DB; border-top-style: none; border-right-style: none; border-bottom-style: none;">Sortiment</a>
                                </li>
                                <li>
                                    <a data-toggle="tab" href="#kund_kort" style="border: 1px solid #CED2DB; border-top-style: none; border-right-style: none; border-bottom-style: none;">Kundkort</a>
                                </li>
                                <li>
                                    <a data-toggle="tab" href="#bilder" style="border: 1px solid #CED2DB; border-top-style: none; border-right-style: none; border-bottom-style: none;">Bilder</a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <!-- Butiksorder -->
                                <div id="butiksorder" class="tab-pane fade in active col-xs-12 col-md-12 col-lg-12" style="padding: 0px;">
                                    <div class="container">
                                        <!-- content -->
                                        <div class="tab-content">
                                            <t t-foreach="product_categories" t-as="brand_categories">
                                                <div t-att-class="'tab-pane fade in active col-xs-12 col-md-12 col-lg-12' if brand_categories == product_categories[0] else 'tab-pane fade in col-xs-12 col-md-12 col-lg-12'"
                                                t-att-id="'categs_%s' %brand_categories.id" style="padding: 0px;">
                                                    <!-- selection for product category -->
                                                    <div class="form-group">
                                                        <div class="col-md-12 col-sm-12 col-xs-12 mt16 mb16">
                                                            <div class="col-md-12 col-sm-12 col-xs-12">
                                                                <select name="" id="product_tab" class="form-control selectpicker dropdown selection_dropdown" data-style="btn-primary" onchange="product_tab()">
                                                                    <t t-set="brand_categs" t-value="request.env['product.category'].search([('parent_id', '=', brand_categories.id)])"/>
                                                                    <t t-if="len(brand_categs) &gt; 0" t-foreach="brand_categs" t-as="b_c">
                                                                        <option data-toggle="tab" style="padding: 5px;" t-att-href="'&#35;product_categ_%s' %b_c.id" t-att-value="'product_categ_%s' %b_c.id"><span t-field="b_c.name" style="color: #FFA62B;"/></option>
                                                                    </t>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
<!--
                                                    <ul class="dropdown-menu">
                                                        <t t-set="brand_categs" t-value="request.env['product.category'].search([('parent_id', '=', brand_categories.id)])"/>
                                                        <t t-if="len(brand_categs) &gt; 0" t-foreach="brand_categs" t-as="b_c">
                                                            <li t-att-class="'%s' %'active' if b_c == brand_categs[0] else ''">
                                                                <a data-toggle="tab" style="padding: 5px;" t-att-href="'&#35;product_categ_%s' %b_c.id">
                                                                    <span t-field="b_c.name" style="color: #FFA62B;"/>
                                                                </a>
                                                            </li>
                                                        </t>
                                                    </ul>
-->
                                                    <div class="tab-content">
                                                        <t t-set="brand_categs" t-value="request.env['product.category'].search([('parent_id', '=', brand_categories.id)])"/>
                                                        <t t-if="len(brand_categs) &gt; 0" t-foreach="brand_categs" t-as="b_c">
                                                            <div t-att-class="'tab-pane product_tab fade col-xs-12 col-md-12 col-lg-12 active in'
                                                                if b_c == brand_categs[0] else
                                                                'tab-pane product_tab fade col-xs-12 col-md-12 col-lg-12'"
                                                                t-att-id="'product_categ_%s' %b_c.id" style="padding: 0px;">
                                                                <t t-foreach="b_c" t-as="p_c">
                                                                    <t t-set="order_line" t-value="request.env['rep.order.line'].search([('order_id', '=', order.id)])"/>
                                                                    <table class="table table-striped" style="">
<!--
                                                                        <thead>
                                                                            <tr>
                                                                                <th class="text-center" style="background-color: #000; color: #fff;">Products</th>
                                                                            </tr>
                                                                        </thead>
-->
                                                                        <tbody>
                                                                            <t t-foreach="products" t-as="p">
                                                                            <tr>
                                                                                <t t-if="p.categ_id in p_c">
                                                                                    <t t-set="order_line_qty" t-value="0"/>
                                                                                    <t t-set="order_line_discount" t-value="0"/>
                                                                                    <t t-foreach="order_line" t-as="ol">
                                                                                        <t t-if="ol.product_id.id == p.id">
                                                                                            <t t-set="order_line_qty" t-value="ol.product_uom_qty"/>
                                                                                            <t t-set="order_line_discount" t-value="ol.discount"/>
                                                                                        </t>
                                                                                    </t>
                                                                                    <td>
                                                                                        <div class="col-md-12 mb16">
                                                                                            <div class="col-md-12">
                                                                                                <h4 class="text-center mt4 mb4" t-field="p.default_code"/>
                                                                                            </div>
                                                                                            <div class="col-md-12">
                                                                                                <h3 class="text-center mt4 mb4 order_product_name cutable" t-att-onclick="'toggle_cell(&quot;%s&quot;)' %p.id" t-field="p.name"/>
                                                                                            </div>
                                                                                            <div class="col-md-12">
                                                                                                <h4 class="text-center mt4 mb16">Kvantitet / <t t-esc="p.uom_id.name"/></h4>
                                                                                            </div>
                                                                                            <div class="col-md-12 input-group oe_website_spinner" style="margin: auto;">
                                                                                                <span class="input-group-addon quantity-button float_left" style="width: 60px; margin: 0px 7px;" t-att-onclick="'plus(&quot;%s_qty_%s&quot;); send_rep_order(&quot;%s&quot;, &quot;%s&quot;)' %(partner.id, p.id, partner.id, p.id)">
                                                                                                    <i class="fa fa-plus" style="width: 40px;"/>
                                                                                                </span>
                                                                                                <!-- <span class="input-group-addon">Quantity: </span> -->
                                                                                                <input class="form-control input-style" style="width: 100px; margin: 0px 7px;" data-min="0" t-att-id="'%s_qty_%s' %(partner.id, p.id)" t-att-onchange="'send_rep_order(&quot;%s&quot;, &quot;%s&quot;)' %(partner.id, p.id)" name="add_qty" t-att-value="'0' if order_line_qty == 0.0 else order_line_qty" type="number"/>
                                                                                                <!-- <span class="input-group-addon"><t t-esc="p.uom_id.name"/></span> -->
                                                                                                <span class="input-group-addon quantity-button" style="width: 60px;" t-att-onclick="'minus(&quot;%s_qty_%s&quot;); send_rep_order(&quot;%s&quot;, &quot;%s&quot;)' %(partner.id, p.id, partner.id, p.id)">
                                                                                                    <i class="fa fa-minus" style="width: 40px;"/>
                                                                                                </span>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="table_cell" t-att-id="'product_cell_%s' %p.id">
                                                                                            <div class="col-md-12 input-group oe_website_spinner" style="margin: auto;">
                                                                                                <span class="input-group-addon float_left" style="background-color: #9e9e9e; color: #fff;" t-att-onclick="'plus(&quot;%s_discount_%s&quot;); send_rep_order(&quot;%s&quot;, &quot;%s&quot;)' %(partner.id, p.id, partner.id, p.id)">
                                                                                                    <i class="fa fa-plus"/>
                                                                                                </span>
                                                                                                <span class="input-group-addon" style="">Rabatt: </span>
                                                                                                <input class="form-control" style="width: 100px;" data-min="0" t-att-id="'%s_discount_%s' %(partner.id, p.id)" t-att-onchange="'send_rep_order(&quot;%s&quot;, &quot;%s&quot;)' %(partner.id, p.id)" name="discount" t-att-value="'0' if order_line_discount == 0.0 else order_line_discount" type="number"/>
                                                                                                <span class="input-group-addon" style="">%</span>
                                                                                                <span class="input-group-addon" style="background-color: #9e9e9e; color: #fff;" t-att-onclick="'minus(&quot;%s_discount_%s&quot;); send_rep_order(&quot;%s&quot;, &quot;%s&quot;)' %(partner.id, p.id, partner.id, p.id)">
                                                                                                    <i class="fa fa-minus"/>
                                                                                                </span>
                                                                                            </div>
                                                                                            <ul class="mt16 text-center" style="list-style-type: none; padding: 0px;">
                                                                                                <li>KFP: <span t-field="p.weight"/></li>
                                                                                                <t t-set="packaging_id" t-value="p.packaging_ids and p.packaging_ids[0]"/>
                                                                                                <t t-if="packaging_id">
                                                                                                    <li>DFP: <span t-field="packaging_id.qty"/></li>
                                                                                                    <li>PALL: <span t-field="packaging_id.ul_qty"/></li>
                                                                                                </t>
                                                                                                    <li>NR: <span t-esc="p.get_store_code(partner.id)"/></li>
                                                                                            </ul>
                                                                                        </div>
                                                                                    </td>
                                                                                </t>
                                                                            </tr>
                                                                            </t>
                                                                        </tbody>
                                                                    </table>
                                                                </t>
                                                            </div>
                                                        </t>
                                                    </div>
                                                </div>
                                            </t>
                                        </div>
                                    </div>
                                    <div class="container form-group">
                                        <div class="col-md-12 col-sm-12 col-xs-12">
<!--
                                            <label class="col-md-3 col-sm-3 col-xs-3 control-label" for="order_type"><span class="pull-right">Beställningstyp:</span></label>
-->
                                            <div class="col-md-12 col-sm-12 col-xs-12 mb16">
                                                <select name="order_type" id="order_type" class="form-control selectpicker dropdown selection_dropdown" data-style="btn-primary" t-att-onchange="'change_order_type(&quot;%s&quot;)' %order.id">
                                                    <t t-foreach="request.env['rep.order'].fields_get(['order_type'])['order_type']['selection']" t-as="order_type">
                                                        <option t-att-value="order_type[0]" t-att="{'selected': 'checked'} if order_type[0] == order.order_type else {}"><t t-raw="order_type[1]"/></option>
                                                    </t>
                                                </select>
                                            </div>
<!--
                                            <label class="col-md-3 col-sm-3 col-xs-3 control-label" for="campaign"><span class="pull-right">Kampanj:</span></label>
-->
                                            <div class="col-md-12 col-sm-12 col-xs-12 mb16">
                                                <select name="campaign" id="campaign" class="form-control selectpicker dropdown selection_dropdown" data-style="btn-primary" t-att-onchange="'change_campaign(&quot;%s&quot;)' %order.id">
                                                    <option value="">Kampanj</option>
                                                    <t t-foreach="request.env['crm.lead'].search([('partner_id', '=', partner.id)])" t-as="aa">
                                                        <option t-if="aa.campaign" t-att-value="aa.campaign.id"><t t-raw="aa.campaign.name"/></option>
                                                    </t>
                                                </select>
                                            </div>
<!--
                                            <label class="col-md-3 col-sm-3 col-xs-3 control-label" for="leveransvecka"><span class="pull-right">Leveransdag:</span></label>
-->
                                            <div class="input-group col-md-12 col-sm-12 col-xs-12 mb16" style="padding: 0px 15px 0px 15px; margin: auto;">
                                                <input id="delivery_date" type="date" name="Delivery Date" class="form-control selection_dropdown" data-style="btn-primary" t-att-onchange="'change_delivery_date(&quot;%s&quot;)' %order.id" placeholder="Leveransdatum"/>
                                                <span id="calendar-icon" class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12 checkbox mb16 text-center">
                                        <label class="" for="send_mail"><input name="send_mail" id="send_mail" value="send" type="checkbox"/>Kopia till epost</label>
                                    </div>
                                    <div class="col-md-12 mb32">
                                        <button id="confirm" name="confirm" style="margin: auto; display: block; background-color: #9e9e9e; color: #fff; padding: 20px 40px; font-size: 2.3em; " class="btn btn-lg" t-att-onclick="'order_confirm(&quot;%s&quot;)' %order.id">Skicka order</button>
                                    </div>
                                </div>

                                <!-- Kedjans sortiment -->
                                <div id="kedjans_sortiment" class="tab-pane fade in col-xs-12 col-md-12 col-lg-12" style="padding: 0px;">
                                    <div class="container mt8 mb8" style="padding: 0px;">
                                        <!-- <h2 class="text-center mb32" t-esc="partner.listing_id.name"/> -->
                                        <t t-foreach="parent_products" t-as="pp">
                                            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 mt8 mb8 sort_products">
                                                <div t-att-id="'ksp_%s_minus' %pp.id" t-att-onclick="'remove_product(&quot;%s&quot;, &quot;%s&quot;)' %(partner.id, pp.id)" t-att-class="'hidden' if pp not in partner.product_ids else 'col-xs-3 col-sm-3 col-md-3 col-lg-3 pull-left product_minus'" style="background-color: #FF4F35; height: 100%; color: #fff;">
                                                    <div class="text-center">
                                                        <i class="fa fa-minus" style="font-size: 3.3em; margin-top: 100px;　vertical-align: middle;"/>
                                                    </div>
                                                </div>
                                                <div t-att-id="'ksp_%s_product' %pp.id" class="col-xs-9 col-sm-9 col-md-9 col-lg-9" style="height: 100%;">
                                                    <img itemprop="image" class="img img-responsive" style="margin: auto; padding-top: 10px;" t-att-src="'/website/image/product.product/%s/image/150x150' %pp.id"/>
                                                    <div class="text-center">
                                                        <t t-if="pp.default_code">
                                                            <h4 t-esc="pp.default_code"/>
                                                        </t>
                                                        <h3 class="text-center sort_product_name cutable" t-field="pp.product_tmpl_id"/>
                                                    </div>
                                                </div>
                                                <div t-att-id="'ksp_%s_plus' %pp.id" t-att-onclick="'add_product(&quot;%s&quot;, &quot;%s&quot;)' %(partner.id, pp.id)" t-att-class="'hidden' if pp in partner.product_ids else 'col-xs-3 col-sm-3 col-md-3 col-lg-3 pull-right product_plus'" style="background-color: #FAC134; height: 100%; color: #fff;">
                                                    <div class="text-center">
                                                        <i class="fa fa-plus" style="font-size: 3.3em; margin-top: 100px;　vertical-align: middle;"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                </div>

                                <!-- Kundkort -->
                                <section id="kund_kort" class="tab-pane fade in col-xs-12 col-md-12 col-lg-12" style="padding: 0px;">
                                    <div class="row">
                                        <!-- partner information -->
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 mt16 mb8 text-center">
                                            <div class="col-xs-12" style="background-color: rgba(255, 148, 0, 0.2); padding: 16px 0px;">
                                                <ul style="list-style-type: none;">
                                                    <li t-if="partner.gs1_gln">GLN Nr: <t t-esc="partner.gs1_gln"/></li>
                                                    <li t-if="partner.phone">Telephone: <t t-esc="partner.phone"/></li>
                                                    <li t-if="partner.email">Email: <t t-esc="partner.email"/></li>
                                                    <li t-if="partner.ref">Reference Nr: <t t-esc="partner.ref"/></li>
                                                    <li t-if="partner.street">Address: <t t-esc="partner.street"/></li>
                                                    <li t-if="partner.zip or partner.city"><t t-if="partner.zip"><t t-esc="partner.zip"/></t>  <t t-if="partner.city"><t t-esc="partner.city"/></t></li>
                                                </ul>
                                                <t t-if="partner.child_ids">
                                                    <t t-foreach="partner.child_ids" t-as="c">
                                                        <p t-if="c.name"><i class="fa fa-user"/> <t t-esc="c.name"/><t t-if="c.function">, <t t-esc="c.function"/></t></p>
                                                        <ul style="list-style-type: none;">
                                                            <li t-if="c.phone"><i class="fa fa-phone"/> <a t-att-href="'tel:%s' %c.phone"><t t-esc="c.phone"/></a></li>
                                                            <li t-if="c.mobile"><i class="fa fa-mobile"/> <a t-att-href="'tel:%s' %c.phone"><t t-esc="c.mobile"/></a></li>
                                                        </ul>
                                                    </t>
                                                </t>
                                            </div>
                                        </div>
                                        <!-- partner opportunities -->
                                        <t t-set="oppors" t-value="request.env['crm.lead'].sudo().search([('partner_id', '=', partner.id)])"/>
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 mt8 mb8 text-center">
                                            <div t-if="oppors" class="col-xs-12" style="background-color: rgba(0, 255, 0, 0.2);">
                                                <h4 class="text-center" style="color: rgba(0, 123, 0, 1); padding-top: 8px;">Opportunity:</h4>
                                                <t t-foreach="oppors" t-as="opp">
                                                    <div class="mb8" style="padding: 10px; background-color: rgba(0, 0, 0, 0.2);">
                                                        <strong>
                                                            <span t-field="opp.name"/>
                                                            <span><t t-esc="'%.0d' %opp.planned_revenue"/> <t t-esc="opp.revenue_unit"/></span>
                                                            <span t-field="opp.campaign"/>
                                                            <span t-if="opp.campaign.account_id" t-field="opp.campaign.account_id.name"/>
                                                        </strong>
                                                        <p t-if="opp.description">
                                                            <span t-field="opp.description"/>
                                                        </p>
                                                    </div>
                                                </t>
                                            </div>
                                        </div>
                                        <!-- partner todo list -->
                                        <t t-set="notes" t-value="request.env['note.note'].search(['&amp;', '&amp;', ('partner_id', '=', partner.id), ('open', '=', True), ('stage_id', '!=', request.env.ref('note.note_stage_04').id)])"/>
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 mt8 mb8">
                                            <div class="col-xs-12" style="background-color: rgba(0, 0, 255, 0.15);">
                                                <t t-if="notes">
                                                    <h4 class="text-center" style="color: rgba(0, 0, 255, 1); padding-top: 8px;">TODO Notes:</h4>
                                                    <t t-foreach="notes" t-as="note">
                                                        <div t-att-id="'note_%s' %note.id" t-att-onclick="'todo_done(&quot;%s&quot;)' %note.id" class="mb8" style="padding: 10px; background-color: rgba(0, 0, 0, 0.2);">
                                                            <p t-att-id="'note_%s_text' %note.id" class="text-center" style="margin-top: 10px;">
                                                                <span t-field="note.name" style="color: #000; padding: 5px; margin: 0px;"/>
                                                            </p>
                                                        </div>
                                                    </t>
                                                </t>
                                            </div>
                                        </div>
                                        <!-- buttons for create log -->
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 mt8 mb8">
                                            <div class="mt32 mb32">
                                                <button t-att-id="'%s_p_fa' %partner.id" t-att-onclick="'paolos_farsk(&quot;%s&quot;, &quot;Paolos Färsk&quot;)' %partner.id" class="btn btn-warning mt16 mb16" style="margin: auto; display: block;">Paolos Färsk</button>
                                                <button t-att-id="'%s_p_fr' %partner.id" t-att-onclick="'paolos_frys(&quot;%s&quot;, &quot;Paolos Frys&quot;)' %partner.id" class="btn btn-default mt16 mb16" style="margin: auto; display: block;">Paolos Frys</button>
                                                <button t-att-id="'%s_l_fa' %partner.id" t-att-onclick="'leroy_farsk(&quot;%s&quot;, &quot;Leröy Färsk&quot;)' %partner.id" class="btn btn-primary mt16 mb16" style="margin: auto; display: block;">Leröy Färsk</button>
                                            </div>
                                        </div>
                                        <!-- buttons for mark meeting done -->
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 mt8 mb8">
                                            <t t-if="len(partner._get_meeting()) &gt; 0">
                                                <t t-set="meeting" t-value="partner._get_meeting()[0]"/>
                                                <div t-if="request.env.ref('crm_repord.categ_meet6') not in meeting.categ_ids" class="mt32">
                                                    <button t-att-id="'%s_meeting' %partner.id" t-att-onclick="'customer_visited(&quot;%s&quot;)' %partner.id" class="btn btn-success" style="margin: auto; display: block;">Customer Visited</button>
                                                </div>
                                            </t>
                                        </div>
                                    </div>
                                </section>

                                <!-- Bilder -->
                                <div id="bilder" class="tab-pane fade in col-xs-12 col-md-12 col-lg-12" style="padding: 0px;">
                                    <div class="container">
                                        <div class="row">
                                            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 mt32 mb32">
                                                <form id="photo_form" t-att-action="'/crm/%s/image_upload' % partner.id" class="" method="post" enctype="multipart/form-data">
                                                    <input id="upload_file" type="file" name="ufile" accept="image/*" capture="camera" style="margin: auto;"/>
                                                </form>
                                            </div>
                                            <div id="image_div" class="col-xs-12 col-sm-12 col-md-12 col-lg-12 mb8">
                                                <t t-set="attachments" t-value="request.env['ir.attachment'].search([('partner_id', '=', partner.id)])"/>
                                                <t t-foreach="attachments" t-as="att">
                                                    <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6" style="padding: 8px;">
                                                        <img itemprop="image" t-att-src="website.imagemagick_url(att, 'datas', 'crm_repord.product_image')" style="margin: auto; display: block; width: 100%;"/>
                                                    </div>
                                                </t>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="mystores" name="My Stores">
        <t t-call="website.layout">
            <div id="wrap">
                <div class="oe_structure">
                    <t t-call="crm_repord.search_stores"/>
                    <div class="container" style="width: 100%; padding: 20px; background-color: #fff;">
                        <t t-set="store_color" t-value="{'A': '#F00', 'B': '#FF7500', 'C': '#BBAA00', 'D': '#2CFF00', 'E': '#000BFF'}"/>
                        <h3 class="text-center">ICA</h3>
                        <div class="col-md-12 col-sm-12 mt8 mb8" t-foreach="my_icas" t-as="ms">
                            <span t-att-style="'background-color: %s; color: #fff; margin-right: 5px;' %(store_color[ms.store_class] if ms.store_class else '#fff')"><span t-field="ms.store_class" style="padding: 5px;"/></span>
                            <a t-att-href="'/crm/%s/repord' %ms.id"><span style="font-size: 1.5em;" t-field="ms.name"/>, <span t-field="ms.street"/> <span t-field="ms.city"/></a>
                        </div>
                        <h3 class="text-center">Coop</h3>
                        <div class="col-md-12 col-sm-12 mt8 mb8" t-foreach="my_coops" t-as="ms">
                            <span t-att-style="'background-color: %s; color: #fff; margin-right: 5px;' %(store_color[ms.store_class] if ms.store_class else '#fff')"><span t-field="ms.store_class" style="padding: 5px;"/></span>
                            <a t-att-href="'/crm/%s/repord' %ms.id"><span style="font-size: 1.5em;" t-field="ms.name"/>, <span t-field="ms.street"/> <span t-field="ms.city"/></a>
                        </div>
                        <h3 class="text-center">Axfood</h3>
                        <div class="col-md-12 col-sm-12 mt8 mb8" t-foreach="my_axfoods" t-as="ms">
                            <span t-att-style="'background-color: %s; color: #fff; margin-right: 5px;' %(store_color[ms.store_class] if ms.store_class else '#fff')"><span t-field="ms.store_class" style="padding: 5px;"/></span>
                            <a t-att-href="'/crm/%s/repord' %ms.id"><span style="font-size: 1.5em;" t-field="ms.name"/>, <span t-field="ms.street"/> <span t-field="ms.city"/></a>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="search_result" name="Search Result">
        <t t-call="website.layout">
            <div id="wrap">
                <div class="oe_structure">
                    <t t-call="crm_repord.search_stores"/>
                    <div class="container" style="width: 100%; padding: 20px; background-color: #fff;">
                        <t t-set="store_color" t-value="{'A': '#F00', 'B': '#FF7500', 'C': '#BBAA00', 'D': '#2CFF00', 'E': '#000BFF'}"/>
                        <div class="col-md-12 col-sm-12 mt8 mb8" t-foreach="partners" t-as="p">
                            <span t-att-style="'background-color: %s; color: #fff; margin-right: 5px;' %(store_color[p.store_class] if p.store_class else '#fff')"><span t-field="p.store_class" style="padding: 5px;"/></span>
                            <a t-att-href="'/crm/%s/repord' %p.id"><span style="font-size: 1.5em;" t-field="p.name"/>, <span t-field="p.street"/> <span t-field="p.city"/></a>
                        </div>
                        <div t-if="len(partners) == 0" class="col-md-12 col-sm-12 mt8 mb8">
                            <p class="text-center">Ingen butik har hittat...</p>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="search_stores" name="Search Stores">
        <div class="container" style="width: 100%; background-color: #535353; height: 50px; padding: 0px;">
            <div class="col-md-12 col-xs-12">
                <div class="col-md-2 col-xs-2">
                    <a href="/crm/mystores">
                        <span class="pagination input-group-btn" style="margin: 8px 0px;">
                            <button class="btn btn-default" style="background-color: #535353; border-color: #535353; color: #a4a4a4; text-decoration: underline;"><strong>Mina butiker</strong></button>
                        </span>
                    </a>
                </div>
                <div class="col-md-8 col-xs-8">
                    <form action="/crm/search/stores" method="post" class="pagination form-inline" style="width: 100%; margin: 8px 0px;">
                        <div id="search_text" class="input-group">
                            <input type="text" name="search_words" t-att-value="search_words" class="search-query form-control" placeholder="Sök..."/>
<!--
                            <span class="input-group-btn">
                                <button class="btn btn-default" type="submit"><i class="fa fa-search"></i></button>
                            </span>
-->
                        </div>
                    </form>
                </div>
                <div class="col-md-2 col-xs-2">
                    <span class="input-group-btn text-center" style="height: 50px;">
                        <button id="search_button" class="btn btn-default" style="color: #a4a4a4;"><i class="fa fa-search"></i></button>
                    </span>
                </div>
            </div>
        </div>
    </template>

    <template id="crm_css" inherit_id="website.layout">
        <xpath expr="//t[@t-call-assets='website.assets_frontend']" position="after">
            <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400" rel="stylesheet"/>
            <style>
                .navbar-static-top > .container {
                    height: 100px;
                }

                .navbar-static-top > .container > .navbar-header {
                    padding-top: 25px;
                }

                .navbar-static-top > .navbar-header > .navbar-toggle > span.icon-bar {
                    width: 30px;
                }

                .navbar-static-top > .navbar-header > .navbar-toggle > span.icon-bar:first-child {
                    margin-bottom: 7px;
                }

                .navbar-static-top > .navbar-header > .navbar-toggle > span.icon-bar:last-child {
                    margin-top: 7px;
                }

                input[type=number]::-webkit-inner-spin-button,
                input[type=number]::-webkit-outer-spin-button {
                    -webkit-appearance: none;
                    margin: 0;
                }

                input[type='number'] {
                    -moz-appearance: textfield;
                }

                .p_exist{ background: #FFD08F; }

                .p_not_exist{ background: #C2FFC2; }

                #wrap { font-family: 'Open Sans', sans-serif; font-weight: 400; background-color: #f8f8f8;}

                .navbar-static-top { background-color: #FFD529; }

                .navbar-toggle { border: none; }

                .navbar-toggle:hover, .navbar-toggle:active, .navbar-toggle:focus { background: none; }

                .navbar-default .navbar-toggle .icon-bar { background-color: #fff; }

                .navbar-brand > img { padding-top: 10px; }

                .nav-brand > li {
                    float: none;
                    display: inline-block;
                    *display:inline; /* ie7 fix */
                    zoom:1; /* hasLayout ie7 trigger */
                    height: 60px;
                }

                .nav-tabs.nav-brand > li.active, .nav-tabs.nav-justified > li:focus {
                    border: 0px solid #F6BB43;
                    background: #F6BB43;
                }

                ul.nav-brand > li > a {
                    color: #A0A0A0;
                    background-color: #E6E9EE;
                    height: 60px;
                }

                .nav-brand > li > a > span {
                    border-width: 0px;
                    height: 60px;
                    font-size: 1.7em;
                }

                .nav-tabs.nav-brand > li.active > a, .nav-tabs.nav-brand > li.active > a:hover, .nav-tabs.nav-brand > li.active > a:focus {
                    background: none;
                    color: #fff;
                }

                .nav-categ > li, .nav-brand > li {
                    display: table-cell;
                    width: 1%;
                    margin-bottom: 0;
                }

                .nav-categ > li > a {
                    background-color: #E6E9EE;
                    color: #6c6c6c;
                    height: 40px;
                    font-size: 1.0em;
                    vertical-algin: middle;
                }

                .nav-tabs.nav-categ > li.active > a, .nav-tabs.nav-categ > li.active > a:hover, .nav-tabs.nav-categ > li.active > a:focus {
                    background: none;
                }

                .nav-categ > li.active > a, .nav-categ > li.active:hover > a, .nav-categ > li.active:focus > a{
                    background-color: #fff !important;
                    color: #333;
                }

                .nav-categ > li:hover > a, .nav-categ > li:focus > a{
                    background-color: none;
                    color: #333;
                }

                .nav-categ > li.active, .nav-categ > li.active:hover, .nav-categ > li.active:focus{
                    background-color: #fff;
                }

                .nav-tabs { border: none; }

                .nav-tabs.nav-justified > .active > a, .nav-tabs.nav-justified > .active > a:hover, .nav-tabs.nav-justified > .active > a:focus {
                    border: none;
                }

                .nav-categ > li > a { border: none; }

                .nav-tabs.nav-justified > li > a {
                    border-radius: 0px;
                    margin: 0px;
                }

                .nav-brand > li > a, {
                    color: #fff;
                    background-color: #F6BB43;
                    height: 60px;
                }

                #butiksorder, #kedjans_sortiment, #kund_kort, #bilder { background-color: #fff; }

                .selection_dropdown {
                    color: #fff;
                    background-color: #F6BB43;
                    height: 60px;
                    font-size: 1.7em;
                    border: 0px solid #F6BB43;
                    border-radius: 10px;
                }

                #calendar-icon {
                    width: 60px;
                    background-color: #F6BB43;
                    color: #fff;
                    font-size: 1.7em;
                    border: 0px solid #F6BB43;
                    background-color: #F6BB43;
                    border-radius: 0px 10px 10px 0px;
                }

                .table-striped > tbody > tr:nth-child(2n+1) > td, .table-striped > tbody > tr:nth-child(2n+1) > th {
                    background-color: #eee;
                }

                .table > tbody > tr > td { border: none; }

                .input-style {
                    height: 60px;
                    font-size: 2.0em;
                    border-radius: 10px !important;
                }

                .cutable {
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    margin: auto;
                }

                .order_product_name {
                    max-width: 550px;
                }

                .sort_product_name {
                    max-width: 400px;
                }

                .sort_products {
                    box-shadow: 1px 2px #d8d8d8;
                    height: 250px;
                    padding: 0px;
                }

                .quantity-button {
                    color: #fff;
                    background-color: #9E9E9E;
                    font-size: 1.3em;
                    border-radius: 10px !important;
                }

                #search_text {
                    width: 100%;
                    max-width: 400px;
                    margin: auto;
                    display: table;
                    display: none;
                }

                #search_button {
                    background-color:#535353;
                    color: #fff;
                    border: none;
                    font-size: 25px;
                }


            </style>
        </xpath>
    </template>

    <template id="crm_javascript" inherit_id="website.layout">
        <xpath expr="//body" position="inside">
            <script>
                $("#oe_main_menu_navbar").addClass("hidden-xs");

                $("#search_button").click(function(){
                    $("#search_text").fadeToggle();
                });

                function product_tab()
                {
                    tab_page_id = "#" + document.getElementById("product_tab").value;
                    $(".product_tab").removeClass("active");
                    $(".product_tab").removeClass("in");
                    $(tab_page_id).addClass("active");
                    $(tab_page_id).addClass("in");
                }

                function minus(product_id)
                {
                    value = parseInt(document.getElementById(product_id).value)
                    if(value &gt; 0){
                        value --;
                        document.getElementById(product_id).value = value;
                    }
                }

                function plus(product_id)
                {
                    value = parseInt(document.getElementById(product_id).value) + 1;
                    document.getElementById(product_id).value = value;
                }

                $(".table_cell").hide();
                function toggle_cell(product_id)
                {
                    var product = "product_cell_" + product_id;
                    $("#" + product).slideToggle("slow");
                }

                /* send rep.order */
                function send_rep_order(res_partner, product_id){
                    quantity = res_partner + "_qty_" +product_id;
                    discount = res_partner + "_discount_" +product_id;
                    document.getElementById(quantity).value
                    openerp.jsonRpc("/crm/send/repord", 'call', {
                        'res_partner': res_partner,
                        'product_id': product_id,
                        'product_uom_qty': document.getElementById(quantity).value,
                        'discount': document.getElementById(discount).value
                    });
                }

                /* add product */
                function add_product(res_partner, product_id){
                    openerp.jsonRpc("/crm/add/product", 'call', {
                        'res_partner': res_partner,
                        'product_id': product_id,
                    }).done(function(data){
                        if(data == "added"){
                            // $("#ksp_" + product_id + "_product").css({"background-color": "#fff"});
                            $("#ksp_" + product_id + "_plus").addClass("hidden");
                            $("#ksp_" + product_id + "_minus").removeClass("hidden");
                            $("#ksp_" + product_id + "_minus").addClass("col-xs-3");
                            $("#ksp_" + product_id + "_minus").addClass("col-sm-3");
                            $("#ksp_" + product_id + "_minus").addClass("col-md-3");
                            $("#ksp_" + product_id + "_minus").addClass("col-lg-3");
                        }
                    });
                }

                /* remove product */
                function remove_product(res_partner, product_id){
                    openerp.jsonRpc("/crm/remove/product", 'call', {
                        'res_partner': res_partner,
                        'product_id': product_id,
                    }).done(function(data){
                        if(data == "removed"){
                            // $("#ksp_" + product_id + "_product").css({"background-color": "#f4f4f4"});
                            $("#ksp_" + product_id + "_minus").addClass("hidden");
                            $("#ksp_" + product_id + "_plus").removeClass("hidden");
                            $("#ksp_" + product_id + "_plus").addClass("col-xs-3");
                            $("#ksp_" + product_id + "_plus").addClass("col-sm-3");
                            $("#ksp_" + product_id + "_plus").addClass("col-md-3");
                            $("#ksp_" + product_id + "_plus").addClass("col-lg-3");
                        }
                    });
                }

                /* change rep order type */
                function change_order_type(order){
                    order_type = document.getElementById("order_type").value;
                    openerp.jsonRpc("/crm/repord/type", 'call', {
                        'order': order,
                        'order_type': order_type,
                    }).done(function(data){
                        if(data != "order_type_changed"){
                            window.alert('Something went wrong when changing order type');
                        }
                    });
                }

                /* change campaign */
                function change_campaign(order){
                    campaign_id = document.getElementById("campaign").value;
                    openerp.jsonRpc("/crm/repord/campaign", 'call', {
                        'order': order,
                        'campaign_id': campaign_id,
                    }).done(function(data){
                        if(data != "campaign_changed"){
                            window.alert('Something went wrong when changing campaign');
                        }
                    });
                }

                /* change delivery date */
                function change_delivery_date(order){
                    delivery_date = document.getElementById("delivery_date").value;
                    openerp.jsonRpc("/crm/repord/deliverydate", 'call', {
                        'order': order,
                        'date_order': delivery_date,
                    }).done(function(data){
                        if(data != "delivery_date_changed"){
                            window.alert('Something went wrong when changing delivery date');
                        }
                    });
                }

                /* confirm rep order */
                function order_confirm(order){
                    send_mail = $("#send_mail").is(":checked");
                    openerp.jsonRpc("/crm/repord/confirm", 'call', {
                        'order': order,
                        'send_mail': send_mail
                    }).done(function(data){
                        if(data == "no_email"){
                            window.alert("Den butiken har ingen epost!");
                        }
                        else if(data == "repord_confirmed"){
                            $("#confirm").addClass("hidden");
                        }
                    });
                }

                /* change todo list to done */
                function todo_done(note_id){
                    note_text = "note_" + note_id + "_text";
                    openerp.jsonRpc("/crm/todo/done", 'call', {
                        'note_id': note_id,
                    }).done(function(data){
                        if(data == "note_done"){
                            $("#" + note_text).css({
                                "text-decoration": "line-through",
                                "color": "#f00;",
                                "margin-top": 10 + "px;"
                            });
                        }
                    });
                }

                /* presentation of Paolos färsk */
                function paolos_farsk(partner_id, categ){
                    openerp.jsonRpc("/crm/presentation/done", 'call', {
                        'partner_id': partner_id,
                        'categ': categ,
                    });
                }

                /* presentation of Paolos frys */
                function paolos_frys(partner_id, categ){
                    openerp.jsonRpc("/crm/presentation/done", 'call', {
                        'partner_id': partner_id,
                        'categ': categ,
                    });
                }

                /* presentation of Leröy färsk */
                function leroy_farsk(partner_id, categ){
                    openerp.jsonRpc("/crm/presentation/done", 'call', {
                        'partner_id': partner_id,
                        'categ': categ,
                    });
                }

                /* change status of meeting */
                function customer_visited(partner_id){
                    button = partner_id + "_meeting";
                    openerp.jsonRpc("/crm/meeting/visited", 'call', {
                        'partner_id': partner_id,
                    }).done(function(data){
                        if(data == "meeting_done"){
                            $("#" + button).addClass("hidden");
                        }
                    });
                }

                /* submit file automatically */
                /* option 1 */
                $("#upload_file").live("change", function(){
                    $("#photo_form").submit();
                });

                /* option 2 */
                function upload_photo(){
                    $("#photo_form").submit();
                }

                /* upload photo
                function upload_photo(res_partner){
                window.alert(document.getElementById("upload_file").files[0]).value;
                    openerp.jsonRpc("/crm/upload/photo", 'call', {
                        'res_partner': res_partner,
                        'ufile': document.getElementById("upload_file").files[0],
                    }).done(function(data){
                        if(data == "complete"){
                            window.alert("Upload completed");
                        }
                    });
                }
                */

            </script>
        </xpath>
    </template>

    </data>
</openerp>
